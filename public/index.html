<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Ï∫êÏπòÎßàÏù∏Îìú WIDE - ÏàòÏ†ïÌåê</title>
    <style>
      :root {
        --main-bg: #e9ecef;
        --panel-bg: #ffffff;
        --primary: #4a90e2;
        --accent: #ffeb3b;
      }
      body {
        font-family: "Pretendard", sans-serif;
        background: var(--main-bg);
        margin: 0;
        display: flex;
        flex-direction: column;
        height: 100vh; /* ÌôîÎ©¥ ÍΩâ Ï±ÑÏö∞Í∏∞ */
        overflow: hidden; /* Î∞îÍπ• Ïä§ÌÅ¨Î°§ Î∞©ÏßÄ */
      }
      #login-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      .login-box {
        background: white;
        padding: 40px;
        border-radius: 20px;
        text-align: center;
      }
      header {
        background: var(--primary);
        color: white;
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
        box-sizing: border-box;
      }
      .main-container {
        display: flex;
        flex: 1;
        padding: 20px;
        gap: 20px;
        justify-content: center;
        height: calc(100vh - 60px); /* Ìó§Îçî Ï†úÏô∏Ìïú ÎÜíÏù¥ */
        box-sizing: border-box;
      }
      .user-list-panel {
        width: 200px;
        background: var(--panel-bg);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        overflow-y: auto;
      }
      .user-item {
        padding: 12px;
        border-radius: 10px;
        background: #f8f9fa;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
      }
      .user-item.painter {
        border: 2px solid var(--accent);
        background: #fffde7;
        font-weight: bold;
      }

      .canvas-area {
        flex: 1;
        max-width: 900px;
        background: var(--panel-bg);
        border-radius: 15px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }
      canvas {
        background: #fff;
        border: 2px solid #eee;
        border-radius: 10px;
        cursor: crosshair;
        width: 100%;
        height: auto;
        touch-action: none;
      }
      .toolbar {
        margin-top: 15px;
        display: flex;
        gap: 15px;
        padding: 10px 25px;
        background: #f1f3f5;
        border-radius: 30px;
      }
      .color-dot {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        border: 3px solid white;
      }
      .color-dot.active {
        transform: translateY(-5px);
        border-color: #333;
      }

      .sidebar {
        width: 300px;
        display: flex;
        flex-direction: column;
        background: var(--panel-bg);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        height: 100%;
        box-sizing: border-box;
      }
      #chat-box {
        flex: 1;
        overflow-y: auto;
        border-bottom: 1px solid #eee;
        margin-bottom: 15px;
        padding-right: 5px;
        word-break: break-all;
      }
      .system {
        color: #28a745;
        font-weight: bold;
        text-align: center;
        margin: 10px 0;
        background: #e8f5e9;
        padding: 8px;
        border-radius: 8px;
        font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <div id="login-overlay">
      <div class="login-box">
        <h1>üé® Ï∫êÏπòÎßàÏù∏Îìú WIDE</h1>
        <input type="text" id="nickname-input" placeholder="ÎãâÎÑ§ÏûÑ ÏûÖÎ†•" maxlength="10" style="padding: 10px; margin-bottom: 10px" /><br />
        <button
          onclick="joinGame()"
          style="padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer"
        >
          Í≤åÏûÑ ÏãúÏûë
        </button>
      </div>
    </div>

    <header>
      <div style="font-weight: bold; font-size: 1.2em">CATCH MIND</div>
      <div id="status-text">Ï†ëÏÜç ÎåÄÍ∏∞ Ï§ë...</div>
      <div id="word-display" style="color: var(--accent); font-weight: bold; font-size: 1.4em"></div>
    </header>

    <div class="main-container">
      <div class="user-list-panel" id="user-list"><strong>PLAYERS</strong></div>
      <div class="canvas-area">
        <canvas id="paint" width="850" height="500"></canvas>
        <div class="toolbar" id="palette">
          <div class="color-dot active" style="background: black" onclick="pickColor('black', this)"></div>
          <div class="color-dot" style="background: #e74c3c" onclick="pickColor('#e74c3c', this)"></div>
          <div class="color-dot" style="background: #3498db" onclick="pickColor('#3498db', this)"></div>
          <div class="color-dot" style="background: #2ecc71" onclick="pickColor('#2ecc71', this)"></div>
          <button onclick="pickColor('white', this)" style="border: none; padding: 5px 15px; cursor: pointer; border-radius: 15px">üßπ ÏßÄÏö∞Í∞ú</button>
        </div>
      </div>
      <div class="sidebar">
        <div id="chat-box"></div>
        <div style="display: flex; gap: 5px">
          <input type="text" id="chat-input" style="flex: 1; padding: 8px" placeholder="Ï†ïÎãµ ÏûÖÎ†•..." />
          <button onclick="sendMessage()" style="padding: 8px 15px">Ï†ÑÏÜ°</button>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const canvas = document.getElementById("paint");
      const ctx = canvas.getContext("2d");
      const chatBox = document.getElementById("chat-box");
      const chatInput = document.getElementById("chat-input");
      const userListDiv = document.getElementById("user-list");

      let isDrawing = false;
      let isPainter = false;
      let currentColor = "black";
      let currentPainterId = null;

      function joinGame() {
        const nickname = document.getElementById("nickname-input").value.trim();
        if (!nickname) return;
        socket.emit("set_nickname", nickname);
        document.getElementById("login-overlay").style.display = "none";
      }

      socket.on("update_players", (players) => {
        userListDiv.innerHTML = "<strong>PLAYERS</strong>";
        for (let id in players) {
          const div = document.createElement("div");
          div.className = "user-item" + (id === currentPainterId ? " painter" : "");
          div.innerHTML = `<span>${id === socket.id ? "ÎÇò" : players[id].name}</span><span>${players[id].score}</span>`;
          userListDiv.appendChild(div);
        }
      });

      socket.on("new_round", (data) => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        currentPainterId = data.painterId;
        isPainter = socket.id === data.painterId;
        document.getElementById("status-text").innerText = isPainter ? "ÎãπÏã†ÏùÄ Ï∂úÏ†úÏûêÏûÖÎãàÎã§!" : "Ï†ïÎãµÏùÑ ÎßûÏ∂∞Î≥¥ÏÑ∏Ïöî!";
        document.getElementById("word-display").innerText = "";
        document.getElementById("palette").style.opacity = isPainter ? "1" : "0.3";
      });

      socket.on("get_answer", (ans) => {
        document.getElementById("word-display").innerText = "Ï†úÏãúÏñ¥: " + ans;
      });

      function getCoords(e) {
        const rect = canvas.getBoundingClientRect();
        return { x: (e.clientX - rect.left) * (canvas.width / rect.width), y: (e.clientY - rect.top) * (canvas.height / rect.height) };
      }

      canvas.addEventListener("mousedown", (e) => {
        if (!isPainter) return;
        isDrawing = true;
        const coords = getCoords(e);
        ctx.beginPath();
        ctx.moveTo(coords.x, coords.y);
      });

      canvas.addEventListener("mouseup", () => {
        if (isPainter) {
          isDrawing = false;
          socket.emit("stop_drawing");
        }
      });

      canvas.addEventListener("mousemove", (e) => {
        if (!isDrawing || !isPainter) return;
        const coords = getCoords(e);
        const data = { x: coords.x, y: coords.y, color: currentColor };
        draw(data);
        socket.emit("drawing", data);
      });

      socket.on("drawing", (data) => {
        if (!isPainter) draw(data);
      });
      socket.on("stop_drawing", () => {
        ctx.beginPath();
      });

      function draw(data) {
        ctx.lineWidth = data.color === "white" ? 30 : 5;
        ctx.lineCap = "round";
        ctx.strokeStyle = data.color;
        ctx.lineTo(data.x, data.y);
        ctx.stroke();
      }

      function sendMessage() {
        const msg = chatInput.value.trim();
        if (msg) {
          socket.emit("send_message", msg);
          chatInput.value = "";
        }
      }
      socket.on("receive_message", (data) => {
        const div = document.createElement("div");
        if (data.user === "System") div.className = "system";
        div.innerHTML = `<b>${data.user}:</b> ${data.text}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      });
      chatInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendMessage();
      });
      function pickColor(color, el) {
        if (!isPainter) return;
        currentColor = color;
        document.querySelectorAll(".color-dot").forEach((d) => d.classList.remove("active"));
        if (el.classList.contains("color-dot")) el.classList.add("active");
      }
    </script>
  </body>
</html>


