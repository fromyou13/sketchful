<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ìºì¹˜ë§ˆì¸ë“œ ì˜¨ë¼ì¸</title>
    <style>
      :root {
        --main-bg: #f8f9fa;
        --panel-bg: #ffffff;
        --primary: #4a90e2;
      }
      body {
        font-family: "Pretendard", sans-serif;
        background: var(--main-bg);
        margin: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
      }

      /* ë ˆì´ì•„ì›ƒ */
      header {
        background: var(--primary);
        color: white;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      .main-container {
        display: flex;
        flex: 1;
        padding: 20px;
        gap: 20px;
        overflow: hidden;
      }

      /* ì™¼ìª½: ë„í™”ì§€ ì˜ì—­ */
      .canvas-area {
        flex: 3;
        display: flex;
        flex-direction: column;
        align-items: center;
        background: var(--panel-bg);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      }
      canvas {
        background: #fff;
        border: 2px solid #eee;
        border-radius: 10px;
        cursor: crosshair;
        max-width: 100%;
        height: auto;
      }

      /* íŒ”ë ˆíŠ¸ */
      .toolbar {
        margin-top: 15px;
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .color-dot {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 3px solid transparent;
        cursor: pointer;
        transition: transform 0.2s;
      }
      .color-dot:hover {
        transform: scale(1.2);
      }
      .color-dot.active {
        border-color: #333;
      }

      /* ì˜¤ë¥¸ìª½: ì±„íŒ… ì˜ì—­ */
      .sidebar {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: var(--panel-bg);
        border-radius: 15px;
        padding: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      }
      #chat-box {
        flex: 1;
        overflow-y: auto;
        margin-bottom: 10px;
        border-bottom: 1px solid #eee;
        padding-right: 5px;
      }
      .chat-input-wrapper {
        display: flex;
        gap: 5px;
      }
      input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      button#send-btn {
        padding: 10px 15px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }

      .system {
        color: #28a745;
        font-weight: bold;
        text-align: center;
        font-size: 0.9em;
        margin: 10px 0;
      }
      .user-id {
        font-weight: bold;
        color: #555;
        font-size: 0.8em;
      }
    </style>
  </head>
  <body>
    <header>
      <div style="font-size: 1.5em; font-weight: bold">ğŸ¨ Catch Mind</div>
      <div id="status-text">ì—°ê²° ì¤‘...</div>
      <div id="word-display" style="font-weight: bold; font-size: 1.2em; color: #ffeb3b"></div>
    </header>

    <div class="main-container">
      <div class="canvas-area">
        <canvas id="paint" width="700" height="450"></canvas>
        <div class="toolbar" id="palette">
          <div class="color-dot active" style="background: black" onclick="pickColor('black', this)"></div>
          <div class="color-dot" style="background: #e74c3c" onclick="pickColor('#e74c3c', this)"></div>
          <div class="color-dot" style="background: #3498db" onclick="pickColor('#3498db', this)"></div>
          <div class="color-dot" style="background: #2ecc71" onclick="pickColor('#2ecc71', this)"></div>
          <div class="color-dot" style="background: #f1c40f" onclick="pickColor('#f1c40f', this)"></div>
          <button
            onclick="pickColor('white', this)"
            style="margin-left: 10px; padding: 5px 10px; border-radius: 5px; border: 1px solid #ddd; cursor: pointer"
          >
            ğŸ§¹ ì§€ìš°ê°œ
          </button>
        </div>
      </div>

      <div class="sidebar">
        <div id="chat-box"></div>
        <div class="chat-input-wrapper">
          <input type="text" id="chat-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”!" />
          <button id="send-btn" onclick="sendMessage()">ì „ì†¡</button>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const canvas = document.getElementById("paint");
      const ctx = canvas.getContext("2d");
      const statusText = document.getElementById("status-text");
      const wordDisplay = document.getElementById("word-display");
      const chatBox = document.getElementById("chat-box");
      const chatInput = document.getElementById("chat-input");

      let isDrawing = false;
      let isPainter = false;
      let currentColor = "black";

      function pickColor(color, el) {
        if (!isPainter) return;
        currentColor = color;
        document.querySelectorAll(".color-dot").forEach((d) => d.classList.remove("active"));
        if (el.classList.contains("color-dot")) el.classList.add("active");
      }

      socket.on("new_round", (data) => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        isPainter = socket.id === data.painterId;
        wordDisplay.innerText = "";

        if (isPainter) {
          statusText.innerText = "ë‹¹ì‹ ì€ ì¶œì œìì…ë‹ˆë‹¤!";
          document.getElementById("palette").style.opacity = "1";
        } else {
          statusText.innerText = "ë¬¸ì œë¥¼ ë§ì¶°ë³´ì„¸ìš”!";
          document.getElementById("palette").style.opacity = "0.3";
        }
      });

      socket.on("get_answer", (answer) => {
        wordDisplay.innerText = "ì œì‹œì–´: " + answer;
      });

      canvas.addEventListener("mousedown", () => {
        if (isPainter) {
          isDrawing = true;
          ctx.beginPath();
        }
      });
      canvas.addEventListener("mouseup", () => (isDrawing = false));
      canvas.addEventListener("mousemove", (e) => {
        if (!isDrawing || !isPainter) return;
        const data = { x: e.offsetX, y: e.offsetY, color: currentColor };
        draw(data);
        socket.emit("drawing", data);
      });

      socket.on("drawing", (data) => {
        if (!isPainter) draw(data);
      });

      function draw(data) {
        ctx.lineWidth = data.color === "white" ? 20 : 4;
        ctx.lineCap = "round";
        ctx.strokeStyle = data.color;
        ctx.lineTo(data.x, data.y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(data.x, data.y);
      }

      function sendMessage() {
        const msg = chatInput.value;
        if (!msg) return;
        socket.emit("send_message", msg);
        chatInput.value = "";
      }

      socket.on("receive_message", (data) => {
        const div = document.createElement("div");
        if (data.user === "System") {
          div.className = "system";
          div.innerText = data.text;
        } else {
          div.innerHTML = `<span class="user-id">${data.user}:</span> ${data.text}`;
        }
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      });

      chatInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendMessage();
      });
    </script>
  </body>
</html>
