<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Ï∫êÏπòÎßàÏù∏Îìú WIDE - ÏôÑÎ≤Ω ÏàòÏ†ïÎ≥∏</title>
    <style>
      :root { --main-bg: #e9ecef; --panel-bg: #ffffff; --primary: #4a90e2; --accent: #ffeb3b; }
      body {
        font-family: "Pretendard", sans-serif; background: var(--main-bg); margin: 0;
        display: flex; flex-direction: column; height: 100vh; overflow: hidden;
      }
      #login-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.85); display: flex; justify-content: center; align-items: center; z-index: 1000;
      }
      .login-box { background: white; padding: 40px; border-radius: 20px; text-align: center; }
      header {
        background: var(--primary); color: white; padding: 15px 30px;
        display: flex; justify-content: space-between; align-items: center; height: 60px; box-sizing: border-box;
      }
      .main-container {
        display: flex; flex: 1; padding: 20px; gap: 20px; justify-content: center;
        height: calc(100vh - 60px); box-sizing: border-box;
      }
      .user-list-panel {
        width: 180px; background: var(--panel-bg); border-radius: 15px;
        padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow-y: auto;
      }
      .user-item {
        padding: 10px; border-radius: 8px; background: #f8f9fa; margin-bottom: 8px;
        display: flex; justify-content: space-between; font-size: 0.9em;
      }
      .user-item.painter { border: 2px solid var(--accent); background: #fffde7; font-weight: bold; }
      .canvas-area {
        flex: 1; max-width: 850px; background: var(--panel-bg); border-radius: 15px;
        padding: 20px; display: flex; flex-direction: column; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      }
      canvas { background: #fff; border: 1px solid #ddd; border-radius: 10px; cursor: crosshair; width: 100%; height: auto; touch-action: none; }
      .toolbar { margin-top: 15px; display: flex; gap: 10px; padding: 8px 20px; background: #f1f3f5; border-radius: 30px; }
      .color-dot { width: 28px; height: 28px; border-radius: 50%; cursor: pointer; border: 2px solid white; }
      .color-dot.active { transform: translateY(-4px); border-color: #333; }
      .sidebar {
        width: 280px; display: flex; flex-direction: column; background: var(--panel-bg);
        border-radius: 15px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); height: 100%; box-sizing: border-box;
      }
      #chat-box { flex: 1; overflow-y: auto; border-bottom: 1px solid #eee; margin-bottom: 15px; padding-right: 5px; word-break: break-all; }
      .system { color: #28a745; font-weight: bold; text-align: center; margin: 8px 0; background: #e8f5e9; padding: 8px; border-radius: 8px; font-size: 0.85em; }
    </style>
  </head>
  <body>
    <div id="login-overlay">
      <div class="login-box">
        <h2>üé® Ï∫êÏπòÎßàÏù∏Îìú</h2>
        <input type="text" id="nickname-input" placeholder="ÎãâÎÑ§ÏûÑ" maxlength="10" style="padding: 10px;" onkeypress="if(event.keyCode==13) joinGame()"/><br /><br />
        <button onclick="joinGame()" style="padding: 10px 30px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer">ÏûÖÏû•</button>
      </div>
    </div>
    <header>
      <div style="font-weight: bold;">CATCH MIND</div>
      <div id="status-text">ÎåÄÍ∏∞ Ï§ë...</div>
      <div id="word-display" style="color: var(--accent); font-weight: bold;"></div>
    </header>
    <div class="main-container">
      <div class="user-list-panel" id="user-list"><strong>PLAYERS</strong></div>
      <div class="canvas-area">
        <canvas id="paint" width="800" height="500"></canvas>
        <div class="toolbar" id="palette">
          <div class="color-dot active" style="background: black" onclick="pickColor('black', this)"></div>
          <div class="color-dot" style="background: #e74c3c" onclick="pickColor('#e74c3c', this)"></div>
          <div class="color-dot" style="background: #3498db" onclick="pickColor('#3498db', this)"></div>
          <div class="color-dot" style="background: #2ecc71" onclick="pickColor('#2ecc71', this)"></div>
          <button onclick="pickColor('white', this)" style="border: none; padding: 5px 12px; cursor: pointer; border-radius: 10px;">ÏßÄÏö∞Í∞ú</button>
        </div>
      </div>
      <div class="sidebar">
        <div id="chat-box"></div>
        <div style="display: flex; gap: 5px">
          <input type="text" id="chat-input" style="flex: 1; padding: 8px" placeholder="Ï†ïÎãµ ÏûÖÎ†•..." />
          <button onclick="sendMessage()">Ï†ÑÏÜ°</button>
        </div>
      </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const canvas = document.getElementById("paint");
      const ctx = canvas.getContext("2d");
      const chatBox = document.getElementById("chat-box");
      const chatInput = document.getElementById("chat-input");
      const userListDiv = document.getElementById("user-list");

      let isDrawing = false, isPainter = false, currentColor = "black", currentPainterId = null;

      function joinGame() {
        const nickname = document.getElementById("nickname-input").value.trim();
        if (nickname) { socket.emit("set_nickname", nickname); document.getElementById("login-overlay").style.display = "none"; }
      }

      socket.on("update_players", (players) => {
        userListDiv.innerHTML = "<strong>PLAYERS</strong>";
        for (let id in players) {
          const div = document.createElement("div");
          div.className = "user-item" + (id === currentPainterId ? " painter" : "");
          div.innerHTML = `<span>${id === socket.id ? "ÎÇò" : players[id].name}</span><span>${players[id].score}</span>`;
          userListDiv.appendChild(div);
        }
      });

      socket.on("new_round", (data) => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        currentPainterId = data.painterId;
        isPainter = socket.id === data.painterId;
        document.getElementById("status-text").innerText = isPainter ? "üñåÔ∏è ÎãπÏã†ÏùÄ Ï∂úÏ†úÏûêÏûÖÎãàÎã§!" : "üßê Ï†ïÎãµÏùÑ ÎßûÏ∂∞Î≥¥ÏÑ∏Ïöî!";
        document.getElementById("word-display").innerText = "";
        document.getElementById("palette").style.opacity = isPainter ? "1" : "0.3";
      });

      socket.on("get_answer", (ans) => { document.getElementById("word-display").innerText = "Ï†úÏãúÏñ¥: " + ans; });

      function getCoords(e) {
        const rect = canvas.getBoundingClientRect();
        return { x: (e.clientX - rect.left) * (canvas.width / rect.width), y: (e.clientY - rect.top) * (canvas.height / rect.height) };
      }

      // [ÌïµÏã¨] ÏÑ† ÎÅäÍ∏∞ Î∞©ÏßÄ Î°úÏßÅ
      canvas.addEventListener("mousedown", (e) => {
        if (!isPainter) return;
        isDrawing = true;
        const coords = getCoords(e);
        ctx.beginPath(); ctx.moveTo(coords.x, coords.y);
        socket.emit("start_drawing", { x: coords.x, y: coords.y, color: currentColor });
      });

      socket.on("start_drawing", (data) => {
        if (!isPainter) {
          ctx.beginPath();
          ctx.strokeStyle = data.color;
          ctx.lineWidth = data.color === "white" ? 30 : 5;
          ctx.moveTo(data.x, data.y);
        }
      });

      canvas.addEventListener("mousemove", (e) => {
        if (!isDrawing || !isPainter) return;
        const coords = getCoords(e);
        const data = { x: coords.x, y: coords.y, color: currentColor };
        draw(data);
        socket.emit("drawing", data);
      });

      socket.on("drawing", (data) => {
        if (!isPainter) {
          ctx.strokeStyle = data.color;
          ctx.lineWidth = data.color === "white" ? 30 : 5;
          ctx.lineTo(data.x, data.y);
          ctx.stroke();
        }
      });

      canvas.addEventListener("mouseup", () => { if (isPainter) { isDrawing = false; socket.emit("stop_drawing"); } });
      socket.on("stop_drawing", () => ctx.beginPath());

      function draw(data) {
        ctx.lineWidth = data.color === "white" ? 30 : 5;
        ctx.lineCap = "round"; ctx.lineJoin = "round";
        ctx.strokeStyle = data.color;
        ctx.lineTo(data.x, data.y); ctx.stroke();
      }

      function sendMessage() {
        const msg = chatInput.value.trim();
        if (msg) { socket.emit("send_message", msg); chatInput.value = ""; }
      }
      socket.on("receive_message", (data) => {
        const div = document.createElement("div");
        if (data.user === "System") div.className = "system";
        div.innerHTML = `<b>${data.user}:</b> ${data.text}`;
        chatBox.appendChild(div); chatBox.scrollTop = chatBox.scrollHeight;
      });
      chatInput.addEventListener("keypress", (e) => { if (e.key === "Enter") sendMessage(); });
      function pickColor(color, el) {
        if (!isPainter) return;
        currentColor = color;
        document.querySelectorAll(".color-dot").forEach((d) => d.classList.remove("active"));
        if (el.classList.contains("color-dot")) el.classList.add("active");
      }
    </script>
  </body>
</html>

