<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ìºì¹˜ë§ˆì¸ë“œ ì™€ì´ë“œ - êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™íŒ</title>
    <style>
      :root {
        --main-bg: #e9ecef;
        --panel-bg: #ffffff;
        --primary: #4a90e2;
        --accent: #ffeb3b;
      }
      body {
        font-family: "Pretendard", sans-serif;
        background: var(--main-bg);
        margin: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
      }

      /* ì…ì¥ ì „ ë¡œê·¸ì¸ í™”ë©´ */
      #login-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      .login-box {
        background: white;
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }
      .login-box input {
        padding: 12px;
        width: 220px;
        border: 2px solid #ddd;
        border-radius: 10px;
        font-size: 1.1em;
        margin-bottom: 20px;
        outline: none;
      }
      .login-box input:focus {
        border-color: var(--primary);
      }
      .login-box button {
        padding: 12px 30px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.1em;
        font-weight: bold;
      }

      header {
        background: var(--primary);
        color: white;
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .main-container {
        display: flex;
        flex: 1;
        padding: 20px;
        gap: 20px;
        justify-content: center;
        align-items: stretch;
      }

      /* ì™¼ìª½ ìœ ì € ëª©ë¡ */
      .user-list-panel {
        width: 200px;
        background: var(--panel-bg);
        border-radius: 15px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }
      .user-item {
        padding: 12px;
        border-radius: 10px;
        background: #f8f9fa;
        border: 2px solid transparent;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .user-item.painter {
        border-color: var(--accent);
        background: #fffde7;
        font-weight: bold;
      }

      /* ì¤‘ì•™ ë„í™”ì§€ ì˜ì—­ */
      .canvas-area {
        flex: 1;
        max-width: 900px;
        background: var(--panel-bg);
        border-radius: 15px;
        padding: 25px;
        display: flex;
        flex-direction: column;
        align-items: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }
      canvas {
        background: #fff;
        border: 2px solid #eee;
        border-radius: 10px;
        cursor: crosshair;
        width: 100%;
        height: auto;
        max-height: 70vh;
        touch-action: none;
      }

      .toolbar {
        margin-top: 20px;
        display: flex;
        gap: 15px;
        padding: 10px 25px;
        background: #f1f3f5;
        border-radius: 30px;
      }
      .color-dot {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        cursor: pointer;
        border: 3px solid white;
        transition: 0.2s;
      }
      .color-dot.active {
        transform: translateY(-5px);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        border-color: #333;
      }

      /* ì˜¤ë¥¸ìª½ ì±„íŒ…ì°½ */
      .sidebar {
        width: 300px;
        display: flex;
        flex-direction: column;
        background: var(--panel-bg);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }
      #chat-box {
        flex: 1;
        overflow-y: auto;
        border-bottom: 1px solid #eee;
        margin-bottom: 15px;
        padding: 5px;
      }
      .chat-input-wrapper {
        display: flex;
        gap: 8px;
      }
      .chat-input-wrapper input {
        flex: 1;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        outline: none;
      }
      .chat-input-wrapper button {
        padding: 10px 15px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
      }

      .system {
        color: #28a745;
        font-weight: bold;
        text-align: center;
        margin: 10px 0;
        background: #e8f5e9;
        padding: 8px;
        border-radius: 8px;
        font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <div id="login-overlay">
      <div class="login-box">
        <h1 style="margin-top: 0; color: var(--primary)">ğŸ¨ ìºì¹˜ë§ˆì¸ë“œ WIDE</h1>
        <p style="color: #666">ì‚¬ìš©í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ê³  ì…ì¥í•˜ì„¸ìš”</p>
        <input type="text" id="nickname-input" placeholder="ë‹‰ë„¤ì„ (ìµœëŒ€ 10ì)" maxlength="10" />
        <br />
        <button onclick="joinGame()">ê²Œì„ ì‹œì‘í•˜ê¸°</button>
      </div>
    </div>

    <header>
      <div style="font-size: 1.5em; font-weight: 900; letter-spacing: 1px">CATCH MIND</div>
      <div id="status-text" style="font-size: 1.1em; background: rgba(0, 0, 0, 0.1); padding: 5px 15px; border-radius: 10px">ëŒ€ê¸° ì¤‘...</div>
      <div
        id="word-display"
        style="
          background: rgba(255, 255, 255, 0.2);
          padding: 5px 20px;
          border-radius: 20px;
          font-size: 1.4em;
          font-weight: bold;
          color: var(--accent);
          min-width: 150px;
          text-align: center;
        "
      ></div>
    </header>

    <div class="main-container">
      <div class="user-list-panel" id="user-list">
        <div style="font-weight: bold; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 10px; color: #555">PLAYERS</div>
      </div>

      <div class="canvas-area">
        <canvas id="paint" width="850" height="550"></canvas>
        <div class="toolbar" id="palette">
          <div class="color-dot active" style="background: black" onclick="pickColor('black', this)"></div>
          <div class="color-dot" style="background: #e74c3c" onclick="pickColor('#e74c3c', this)"></div>
          <div class="color-dot" style="background: #3498db" onclick="pickColor('#3498db', this)"></div>
          <div class="color-dot" style="background: #2ecc71" onclick="pickColor('#2ecc71', this)"></div>
          <div class="color-dot" style="background: #f1c40f" onclick="pickColor('#f1c40f', this)"></div>
          <div style="width: 2px; background: #ddd; margin: 0 5px"></div>
          <button
            onclick="pickColor('white', this)"
            style="border: none; background: #dee2e6; border-radius: 20px; cursor: pointer; padding: 5px 15px; font-weight: bold; transition: 0.2s"
          >
            ğŸ§¹ ì§€ìš°ê°œ
          </button>
        </div>
      </div>

      <div class="sidebar">
        <div id="chat-box"></div>
        <div class="chat-input-wrapper">
          <input type="text" id="chat-input" placeholder="ì •ë‹µ ë˜ëŠ” ë©”ì‹œì§€ ì…ë ¥" />
          <button onclick="sendMessage()">ì „ì†¡</button>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const canvas = document.getElementById("paint");
      const ctx = canvas.getContext("2d");
      const statusText = document.getElementById("status-text");
      const wordDisplay = document.getElementById("word-display");
      const chatBox = document.getElementById("chat-box");
      const chatInput = document.getElementById("chat-input");
      const userListDiv = document.getElementById("user-list");

      let isDrawing = false;
      let isPainter = false;
      let currentColor = "black";
      let currentPainterId = null;

      function joinGame() {
        const nickname = document.getElementById("nickname-input").value.trim();
        if (!nickname) return alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        socket.emit("set_nickname", nickname);
        document.getElementById("login-overlay").style.display = "none";
      }

      socket.on("update_players", (players) => {
        userListDiv.innerHTML =
          '<div style="font-weight: bold; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 10px; color:#555;">PLAYERS</div>';
        for (let id in players) {
          const p = players[id];
          const div = document.createElement("div");
          div.className = "user-item" + (id === currentPainterId ? " painter" : "");
          div.innerHTML = `<span>${id === socket.id ? "<b>ë‚˜</b>" : p.name}</span><span style="font-weight:bold; color:var(--primary)">${
            p.score
          }</span>`;
          userListDiv.appendChild(div);
        }
      });

      socket.on("new_round", (data) => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        currentPainterId = data.painterId;
        isPainter = socket.id === data.painterId;
        wordDisplay.innerText = "";

        if (isPainter) {
          statusText.innerText = "ğŸ¨ ë‹¹ì‹ ì€ ì¶œì œìì…ë‹ˆë‹¤!";
          document.getElementById("palette").style.opacity = "1";
          document.getElementById("palette").style.pointerEvents = "auto";
        } else {
          statusText.innerText = "ğŸ§ ì •ë‹µì„ ë§ì¶°ë³´ì„¸ìš”!";
          document.getElementById("palette").style.opacity = "0.3";
          document.getElementById("palette").style.pointerEvents = "none";
        }
      });

      socket.on("get_answer", (answer) => {
        wordDisplay.innerText = "ì œì‹œì–´: " + answer;
      });

      function pickColor(color, el) {
        if (!isPainter) return;
        currentColor = color;
        document.querySelectorAll(".color-dot").forEach((d) => d.classList.remove("active"));
        if (el.classList.contains("color-dot")) el.classList.add("active");
      }

      // ë§ˆìš°ìŠ¤ ì¢Œí‘œ ë³´ì •
      function getCoords(e) {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        return { x: (e.clientX - rect.left) * scaleX, y: (e.clientY - rect.top) * scaleY };
      }

      canvas.addEventListener("mousedown", (e) => {
        if (isPainter) {
          isDrawing = true;
          const coords = getCoords(e);
          ctx.beginPath();
          ctx.moveTo(coords.x, coords.y);
        }
      });
      canvas.addEventListener("mouseup", () => (isDrawing = false));
      canvas.addEventListener("mousemove", (e) => {
        if (!isDrawing || !isPainter) return;
        const coords = getCoords(e);
        const data = { x: coords.x, y: coords.y, color: currentColor };
        draw(data);
        socket.emit("drawing", data);
      });

      socket.on("drawing", (data) => {
        if (!isPainter) draw(data);
      });

      function draw(data) {
        ctx.lineWidth = data.color === "white" ? 30 : 5;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.strokeStyle = data.color;
        ctx.lineTo(data.x, data.y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(data.x, data.y);
      }

      function sendMessage() {
        const msg = chatInput.value.trim();
        if (!msg) return;
        socket.emit("send_message", msg);
        chatInput.value = "";
      }

      socket.on("receive_message", (data) => {
        const div = document.createElement("div");
        div.style.marginBottom = "8px";
        if (data.user === "System") {
          div.className = "system";
          div.innerText = data.text;
        } else {
          div.innerHTML = `<span style="font-weight:bold; color:#555">${data.user}:</span> ${data.text}`;
        }
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      });

      chatInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendMessage();
      });
    </script>
  </body>
</html>
